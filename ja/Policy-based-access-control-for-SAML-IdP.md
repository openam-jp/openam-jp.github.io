---
title: SAML IdP のポリシーベースアクセス制御
---
このページでは、SAML IdP をポリシーで保護する方法を説明します。

## 設定手順

### 機能の有効化

本機能はデフォルトで無効になっています。有効にするには以下の手順を行ってください。

1. 管理者画面を表示します。
2. `連携`タブ → 対象の IdP → `高度`タブに移動します。
3. IDP アダプタークラスに次のクラスを設定します。
~~~
jp.co.osstech.oam.saml2.plugins.PolicyCheckIDPAdapter
~~~

![IDP アダプタークラス](../../images/ja/saml2/saml2-policy-idpadapter.png "IDP アダプタークラス")

### リソースタイプの登録

1. 管理者画面を表示します。
2. 対象レルム → `認可` → `リソースタイプ` に移動します。
3. 各パラメーターを入力し、`作成`ボタンをクリックします。名前には任意の名称を設定して構いません（その他は固定です）。

| 項目名| 設定 |
|:---------------------|:---------------------------------------------|
| 名前 | (任意) |
| パターン | idpEntityID=\*&spEntityID=\* |
| アクション | IssueAssertion |

![新規リソースタイプ](../../images/ja/saml2/saml2-policy-resource-type.png "新規リソースタイプ")

### ポリシーセットの登録

1. 管理者画面を表示します。
2. 対象レルム → `認可` → `ポリシーセット` に移動します。
3. `新規プロバイダポリシーセット`ボタンをクリックします。

   ![新規プロバイダポリシーセットボタン](../../images/ja/saml2/saml2-policy-policyset1.png "新規プロバイダポリシーセットボタン")

4. 各パラメーターを入力し、`作成`ボタンをクリックします。

| 項目名| 設定 |
|:---------------------|:---------------------------------------------|
| Id | SAML2ProviderService |
| 名前 | (任意) |
| リソースタイプ | (作成したリソースタイプの名前) |

![新規プロバイダポリシーセット](../../images/ja/saml2/saml2-policy-policyset2.png "新規プロバイダポリシーセット")

### ポリシーの登録

1. [ポリシーセットの登録](#ポリシーセットの登録)で作成した `SAML2ProviderService` を表示します。
2. `新しいポリシーの追加`ボタンをクリックします。
3. 各パラメーターを入力し、`作成`ボタンをクリックします。

   | 項目名| 設定 |
   |:---------------------|:---------------------------------------------|
   | 名前 | (任意) |
   | リソースタイプ | (作成したリソースタイプの名前) |
   | リソース | 対象となる IdP と SP の Entity ID を指定 |

   ![新規ポリシー](../../images/ja/saml2/saml2-policy-policy1.png "新規ポリシー")

4. 作成したポリシーに対して `アクション`、`対象`、`環境` を設定します。


