---
title: OIDC OP のポリシーベースアクセス制御
---
このページでは、OIDC OP をポリシーで保護する方法を説明します。

## 設定手順

### 機能の有効化

本機能はデフォルトで無効になっています。有効にするには以下の手順を行ってください。

1. 管理者画面を表示します。
2. 対象レルム → `エージェント` → `OAuth 2.0 クランアント`タブ → 対象の OAuth 2.0 クライアントに移動します。
3. `ポリシーに基づくエンドポイントの保護` の有効にチェックをして`保存`ボタンをクリックします。

![OIDC ポリシー保護の有効化](../../images/ja/oidc-oauth2/oidc-policy-enable.png "OIDC ポリシー保護の有効化")

### リソースタイプの登録

1. 管理者画面を表示します。
2. 対象レルム → `認可` → `リソースタイプ` に移動します。
3. 各パラメーターを入力し、`作成`ボタンをクリックします。名前には任意の名称を設定して構いません（その他は固定です）。

| 項目名| 設定 |
|:---------------------|:---------------------------------------------|
| 名前 | (任意) |
| パターン | client_id=\* |
| アクション | IssueToken |

![新規リソースタイプ](../../images/ja/oidc-oauth2/oidc-policy-resource-type.png "新規リソースタイプ")

### ポリシーセットの登録

1. 管理者画面を表示します。
2. 対象レルム → `認可` → `ポリシーセット` に移動します。
3. `新規プロバイダポリシーセット`ボタンをクリックします。

   ![新規プロバイダポリシーセットボタン](../../images/ja/oidc-oauth2/oidc-policy-policyset1.png "新規プロバイダポリシーセットボタン")

4. 各パラメーターを入力し、`作成`ボタンをクリックします。

| 項目名| 設定 |
|:---------------------|:---------------------------------------------|
| Id | OAuthClientService |
| 名前 | (任意) |
| リソースタイプ | (作成したリソースタイプの名前) |

![新規プロバイダポリシーセット](../../images/ja/oidc-oauth2/oidc-policy-policyset2.png "新規プロバイダポリシーセット")

### ポリシーの登録

1. [ポリシーセットの登録](#ポリシーセットの登録)で作成した `OAuthClientService` を表示します。
2. `新しいポリシーの追加`ボタンをクリックします。
3. 各パラメーターを入力し、`作成`ボタンをクリックします。

   | 項目名| 設定 |
   |:---------------------|:---------------------------------------------|
   | 名前 | (任意) |
   | リソースタイプ | (作成したリソースタイプの名前) |
   | リソース | 対象となる RP のクライアント ID 指定 |

   ![新規ポリシー](../../images/ja/oidc-oauth2/oidc-policy-policy1.png "新規ポリシー")

4. 作成したポリシーに対して `アクション`、`対象`、`環境` を設定します。



